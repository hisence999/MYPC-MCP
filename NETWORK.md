# 网络访问配置指南

## 快速开始

### 本地访问
```
http://localhost:9999
```
默认配置已支持，无需额外设置。

---

## 局域网访问

### 1. 查找本机 IP 地址
打开命令提示符（CMD），运行：
```cmd
ipconfig
```
找到 "IPv4 地址"，例如：`192.168.1.100`

### 2. 配置防火墙
**方法一**：右键以管理员身份运行 `setup-firewall.bat`

**方法二**：手动添加
```cmd
netsh advfirewall firewall add rule name="MyPC-MCP" dir=in action=allow protocol=TCP localport=9999
```

### 3. 访问服务
在局域网内其他设备上访问：
```
http://192.168.1.100:9999
```
（将 `192.168.1.100` 替换为你的实际 IP）

---

## 公网访问

### 1. 路由器端口转发
登录路由器管理页面，添加端口转发规则：

| 外部端口 | 内部端口 | 内部IP地址 | 协议 |
|---------|---------|-----------|------|
| 9999    | 9999    | 192.168.1.100 | TCP |

### 2. 配置 Windows 防火墙
运行 `setup-firewall.bat`（需管理员权限）

### 3. 配置 config.json
```json
{
    "server": {
        "host": "0.0.0.0",
        "domain": "your-domain.com",
        "port": 9999
    }
}
```

### 4. 访问服务
```
http://your-domain.com:9999
```
或
```
http://your-public-ip:9999
```

### 5. 安全建议 ⚠️
- 使用强密码或密钥认证
- 限制 SSH 命令白名单
- 配置安全区限制文件访问
- 考虑使用 VPN 而非直接暴露公网
- 定期更新依赖包

---

## 常见问题

### Q: 无法从局域网访问？
**A**: 检查：
1. 防火墙是否允许端口 9999
2. config.json 中 `host` 是否为 `0.0.0.0`
3. 设备是否在同一局域网

### Q: 无法从公网访问？
**A**: 检查：
1. 路由器端口转发是否正确
2. 公网 IP 是否正确
3. 防火墙规则是否生效
4. ISP 是否封禁了端口 9999

### Q: 如何查看本机 IP？
**A**:
```cmd
ipconfig
```
或
```cmd
curl ifconfig.me
```
查看公网 IP

### Q: 如何更改端口？
**A**: 编辑 `config.json`：
```json
{
    "server": {
        "port": 8080
    }
}
```
然后更新防火墙规则。

---

## 配置文件说明

### server.host 说明
- `"127.0.0.1"` - 仅本机访问
- `"0.0.0.0"` - 所有网络接口（局域网+公网）
- `"192.168.1.100"` - 仅指定 IP

### server.domain 说明
- `"localhost"` - 本机访问
- `"192.168.1.100"` - 局域网 IP
- `"my-domain.com"` - 公网域名

---

## 工具脚本

- `setup-firewall.bat` - 配置防火墙规则（需管理员权限）
- `start.bat` - 启动服务（自动检查依赖和防火墙）
- `stop.bat` - 停止服务

---

## 安全提示

1. **不要在公网直接暴露默认端口**
   - 建议改为随机端口如 54321

2. **限制安全区**
   - 只在 config.json 中添加必要的目录

3. **使用反向代理**
   - 配置 Nginx/Caddy 添加 SSL 和认证

4. **定期检查日志**
   - 监控异常访问和操作
